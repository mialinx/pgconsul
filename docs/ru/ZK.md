## Основные записи в ZK

* `TIMELINE_INFO_PATH` = `timeline`
Содержит таймлайн кластера, те. мастера на момент когда в кластере не было проблем.
Обновляется мастером в итерации нормальной работы.

* `FAILOVER_INFO_PATH` = `failover_state`
Содержит информацию о процесс промоута нового мастера.

* `QUORUM_PATH` = `quorum`
Список реплик, удерживавших `QUORUM_MEMBER_LOCK_PATH` на предыдущей итерации. В процессе failover участвую только те реплики, которые входят в кворум. Обновляется мастером на каждой безпроблемной итерации.

* `REPLICS_INFO_PATH` = `replics_info`
Содержит информацию из `pg_stat_replication` на текущем мастере.
Используется для выбора наиболее актуальной реплики при switchover/failover.

* `SWITCHOVER_STATE_PATH` = `switchover/state`
switchover начитается с того, что CLI или worker записывают сюда `scheduled`.
В дальнейшем старый и новый мастер координируют свои действия в процесс switchover через эту запись.

* `SWITCHOVER_PRIMARY_PATH` = `switchover/master`
Детали выполнения switchover.

        {
            'hostname': primary,        # текущий мастер
            'timeline': timeline,       # последний известный таймлайн кластера перед switchover
            'destination': new_primary, # новый мастер, если switchover идет на конкретный хост
        }

* `CURRENT_PROMOTING_HOST` = `current_promoting_host`
Перед выполнением pg_ctl promote сюда записывается FQDN нового мастера. Эта запись используется если процедура failover/switchover будет прервана по какой-либо причине. Тогда на следующей итерации мастер сможет определить нужно ли ему завершать процедуру (если FQDN совпадает) или отпускать лок и становиться репликой.

* `MAINTENANCE_PATH` = `maintenance`
Используется для включения и отключения режима maintenance

* `MAINTENANCE_TIME_PATH` = `maintenance/ts`
Момент времени, когда был включен maintenance

* `MAINTENANCE_PRIMARY_PATH` = `maintenance/master`
Текущий мастер на момент включения maintenance

## Основные локи в ZK

* `HOST_ALIVE_LOCK_PATH` = `alive/%fqdn%`
Удерживается каждым хостом, если локальный Postgres жив. Используется в разных местах для получения списка живых (но не факт что реплицирующих) хостов.

* `PRIMARY_LOCK_PATH` = `leader`
Основной лок в PgConsul, удерживается мастером.
Исчезновение данного лока является поводом для начала failover.
Лок исчезает при потере мастером сети (те связи с ZK) либо отпускается добровольно при неработоспособности Postgres и в некоторых других случаях.

* `QUORUM_MEMBER_LOCK_PATH` = `quorum/members/%fqdn%`
Используется в режиме кворумной репликации. Удерживается репликой, которая является частью кворума, те. является HA и реплицирует. Отпускается, если реплика обнаружила что репликация не работает, Postgres сломан, либо изменился мастер.

* `SYNC_REPLICA_LOCK_PATH` = `sync_replica`
Используется в режиме синхронной репликации, когда только одна из реплик является синхронной. Удерживается собственно синхронной репликой. Legacy.

* `ELECTION_MANAGER_LOCK_PATH` = `epoch_manager`
Используется для в процессе выбора самой актуальной реплики в процессе failover. Один из участников кворума захватывает этот лок и производит выбор реплики с максимальными LSN. Остальные участники просто предоставляют свои LSN. Лок удерживается на протяжении всего выбора.

* `PRIMARY_SWITCH_LOCK_PATH` = `remaster`
Этот лок берется репликой (либо бывшим мастером), при переключении на новый мастер. Лок берется на время переключения, для того чтобы переключалось не более 1 реплики за раз.

* `SWITCHOVER_LOCK_PATH` = `switchover/lock`
Этот лок берется CLI на момент создания/очистки информации о switchover в ZK. В процессе самого переключения мастера этот лок не участвует.
